var D=Object.defineProperty;var V=(r,e,s)=>e in r?D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var g=(r,e,s)=>V(r,typeof e!="symbol"?e+"":e,s);import{f as P,B as G,C as H,c as y,o as x,a as l,D as _,v as U,l as F,E as N,d as A,G as O,m as I,g as J,t as Z,n as K,H as L,r as R}from"./dfVAeu3s.js";const Q="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23000000'%3e%3cpath%20d='M480-80q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-155.5t86-127Q252-817%20325-848.5T480-880q17%200%2028.5%2011.5T520-840q0%2017-11.5%2028.5T480-800q-133%200-226.5%2093.5T160-480q0%20133%2093.5%20226.5T480-160q133%200%20226.5-93.5T800-480q0-17%2011.5-28.5T840-520q17%200%2028.5%2011.5T880-480q0%2082-31.5%20155t-86%20127.5q-54.5%2054.5-127%2086T480-80Z'/%3e%3c/svg%3e",Y={class:"flex flex-col gap-3"},X={key:0,class:"text-green-700 flex justify-center"},W={key:1,class:"text-red-700 flex justify-center"},ee={key:2,class:"text-red-700 flex justify-center"},se={class:"rounded-full overflow-hidden mx-2"},te={type:"submit",class:"flex gap-2 justify-center cursor-pointer rounded-lg bg-menu-background text-white py-3 px-4"},ae={class:"absolute -translate-x-13"},ue=P({__name:"Form",props:{form:{}},setup(r){const e=G("progressBar");return H(r.form.progress,()=>{r.form.progress.value?e.value.style.translate=`-${(1-r.form.progress.value)*100}%`:e.value.style.translate=""}),(s,t)=>(x(),y("div",null,[l("form",{onSubmit:t[0]||(t[0]=O((...n)=>s.form.send&&s.form.send(...n),["prevent"])),class:"flex flex-col gap-2 bg-white sm:px-6 px-4 sm:pt-4 pt-2 sm:pb-6 pb-4 rounded-xl shadow-lg shadow-black/20"},[_(s.$slots,"default"),l("div",Y,[l("div",null,[s.form.status.value=="success"?(x(),y("div",X,t[1]||(t[1]=[l("p",{class:"text-green-700"},"Erfolgreich abgeschickt!",-1)]))):F("",!0),s.form.status.value=="serverErrror"?(x(),y("div",W,t[2]||(t[2]=[l("p",{class:"text-red-700"},"Fehler beim Senden. Versuche es später nochmal und weise uns gerne per Mail auf diesen Fehler hin.",-1)]))):F("",!0),s.form.status.value=="clientError"?(x(),y("div",ee,t[3]||(t[3]=[l("p",{class:"text-red-700"},"Fehler beim Senden. Überprüfe deine Internetverbindung und versuche es später nochmal.",-1)]))):F("",!0)]),U(l("div",se,[l("div",{ref_key:"progressBar",ref:e,class:"w-full h-2 bg-green-700"},null,512)],512),[[N,s.form.progress.value]]),l("button",te,[U(l("span",ae,t[4]||(t[4]=[l("img",{src:Q,class:"invert animate-spin"},null,-1)]),512),[[N,s.form.status.value=="sending"]]),t[5]||(t[5]=A(" Senden "))])])],32)]))}}),re={class:"flex flex-col my-4"},oe=["required","placeholder"],pe=P({__name:"TextAreaInput",props:I({displayName:{},placeholder:{},required:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=r,s=J(r,"modelValue");return(t,n)=>(x(),y("label",re,[l("span",{class:K(["text-xs ml-2 text-gray-500",{"form-label-required":e.required}])},Z(e.displayName),3),U(l("textarea",{class:"border-b-1 border-gray-400 p-2 h-40",required:e.required,"onUpdate:modelValue":n[0]||(n[0]=c=>s.value=c),placeholder:e.placeholder},null,8,oe),[[L,s.value]])]))}});function le(){return{name:"",email:"",message:"",subject:"",files:[]}}function ne(r,e){return new Promise((s,t)=>{const n=new FileReader;n.readAsDataURL(r),n.onload=()=>{const c=n.result,b=c.indexOf(",")+1,a=c.slice(b);s({type:r.type,data:a,filename:e,size:r.size})},n.onerror=t})}class ce{constructor(e,s){g(this,"formName");g(this,"payload");g(this,"status",R(void 0));g(this,"progress",R(void 0));g(this,"send",async()=>{this.status.value="sending";let e;"generatePayload"in this.payload.value?e=this.payload.value.generatePayload(this.payload.value.data):e=this.payload.value;let s=e.files.sort((a,m)=>m.file.size-a.file.size),t=[];for(;s.map(a=>a.file.size).reduce((a,m)=>a+m,0)>=1e7;)t.push(s.splice(0,1)[0]);const n=await Promise.all(s.map(a=>ne(a.file,a.name)));console.log({attachedFiles:n});const c=(a,m)=>new Promise((i,f)=>{const w=()=>{this.status.value="clientError",f("clientError")},h=()=>{this.status.value="serverErrror",f("serverError")};fetch("https://email-forms-453803557958.europe-west4.run.app",{method:"POST",body:JSON.stringify(a),headers:{"Content-type":"application/json; charset=UTF-8"}}).then(async d=>{d.status===200?(await m(d,w,h),i()):h()}).catch(()=>{w()})}),b=[];if(t.length){let a=0;const m=t.map(i=>i.file.size).reduce((i,f)=>i+f);await c({key:"gDdJR6GNwfZ2Kf4GYCyExzNRm78xGvxd",action:"upload-files",files:t.map(i=>({name:i.name}))},async(i,f,w)=>{const h=await i.json();for(let d=0;d<h.files.length;d++){const S=h.files[d].uploadUri,j=h.files[d].publicUrl,$=t[d].name,p=t[d].file,B=8*1024*1024;let u=0,E=0;const C=5;for(;u<p.size;){console.log({start:u,size:p.size});const q=Math.min(u+B,p.size),M=p.slice(u,q);try{const o=new XMLHttpRequest;o.open("PUT",S),o.setRequestHeader("Content-Range",`bytes ${u}-${q-1}/${p.size}`),o.setRequestHeader("Content-Type",p.type),o.upload.onprogress=v=>{console.log(`Uploaded ${u+v.loaded} of ${p.size}`),this.progress.value=(a+u+v.loaded)/m};const T=new Promise((v,k)=>{o.onload=()=>{if(o.status===200)console.log(`Uploaded ${$}`),u=q,v();else if(o.status===308){const z=o.getResponseHeader("Range");u=parseInt(z.split("-")[1])+1,v()}else k(`Upload failed: ${o.status} ${o.response}`)},o.onerror=z=>{k(z)}});o.send(M),await T}catch(o){if(console.error("Upload error:",o),E++,E>C){f();return}await new Promise(T=>setTimeout(T,2e3))}}b.push({publicUrl:j,name:$}),a+=p.size}})}await c({key:"gDdJR6GNwfZ2Kf4GYCyExzNRm78xGvxd",action:"submit",form:this.formName,name:e.name,email:e.email,subject:e.subject,message:e.message+"<br><br>"+b.map(a=>`<a href="${a.publicUrl}">${a.name}</a>`).join("<br>"),files:n},async()=>{this.status.value="success","generatePayload"in this.payload.value?Object.assign(this.payload.value.data,this.payload.value.emptyData()):Object.assign(this.payload.value,le())}),this.progress.value=void 0});this.formName=e,this.payload=R(s)}}export{ce as F,ue as _,pe as a,le as e};
